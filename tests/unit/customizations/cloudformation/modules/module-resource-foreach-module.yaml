AWSTemplateFormatVersion: '2010-09-09'
Parameters:
  Environments:
    Type: CommaDelimitedList
  BucketPrefix:
    Type: String

Resources:
  Bucket:
    Type: AWS::S3::Bucket
    ForEach: !Ref Environments
    Properties:
      BucketName: !Sub "${BucketPrefix}-bucket-${Identifier}"
      Tags:
        - Key: Environment
          Value: !Sub ${Identifier}

Outputs:
  BucketArns:
    Description: "All bucket ARNs"
    Value: !GetAtt Bucket[*].Arn
  
  DevBucketArn:
    Description: "Dev bucket ARN"
    Value: !GetAtt Bucket[dev].Arn
