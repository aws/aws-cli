AWSTemplateFormatVersion: '2010-09-09'
Description: 'Module with parameter schema validation'

Parameters:
  VpcConfig:
    Type: Object
    Description: "VPC configuration"
  
  Subnets:
    Type: Array
    Description: "Subnet configurations"

ParameterSchema:
  VpcConfig:
    Type: Object
    Required: ["CidrBlock"]
    Properties:
      CidrBlock:
        Type: String
        Pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
      EnableDnsSupport:
        Type: Boolean
        Default: true
      Tags:
        Type: Array
        Default: []
        Items:
          Type: Object
          Required: ["Key", "Value"]
          Properties:
            Key:
              Type: String
              MinLength: 1
            Value:
              Type: String
  
  Subnets:
    Type: Array
    MinItems: 1
    MaxItems: 20
    Items:
      Type: Object
      Required: ["CidrBlock", "AvailabilityZone", "Type"]
      Properties:
        CidrBlock:
          Type: String
          Pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
        AvailabilityZone:
          Type: String
        Type:
          Type: String
          Enum: ["Public", "Private"]

Resources:
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: !Ref VpcConfig.CidrBlock
      EnableDnsSupport: !Ref VpcConfig.EnableDnsSupport
      Tags: !Ref VpcConfig.Tags

Outputs:
  VpcId:
    Description: ID of the VPC
    Value: !Ref VPC
  
  PublicSubnetIds:
    Description: IDs of the public subnets
    Value: ["subnet-12345", "subnet-67890"]
